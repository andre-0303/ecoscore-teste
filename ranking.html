<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ranking dos Cursos 🏆</title>
    <link rel="stylesheet" href="./css/ranking.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <body>
    <h1><i data-lucide="leaf"></i> Ranking dos Cursos</h1>
    <ul id="ranking-list"></ul>

    <a href="./index.html"><i data-lucide="arrow-left"></i> Voltar</a>

    <script>
      async function carregarRanking() {
        try {
          const res = await fetch("http://localhost:3000/registros");
          const registros = await res.json();

          if (registros.length === 0) {
            document.getElementById("ranking-list").innerHTML =
              "<li>Nenhum registro ainda 😕</li>";
            lucide.createIcons();
            return;
          }

          const totais = {};
          for (const r of registros) {
            totais[r.curso] = (totais[r.curso] || 0) + r.peso;
          }

          const ranking = Object.entries(totais).sort((a, b) => b[1] - a[1]);
          const ul = document.getElementById("ranking-list");

          ul.innerHTML = ranking
            .map(
              ([curso, peso], i) => `
              <li class="rank-item">
                <div>
                  ${
                    i === 0
                      ? '<i data-lucide="trophy" class="icon"></i>'
                      : `<i data-lucide="award" class="icon"></i>`
                  }
                  ${i + 1}º <strong>${curso}</strong>
                </div>
                <span>${peso.toFixed(1)} kg</span>
              </li>`
            )
            .join("");

          lucide.createIcons();
        } catch (err) {
          console.error(err);
          document.getElementById("ranking-list").innerHTML =
            "<li>Erro ao carregar ranking 😢</li>";
          lucide.createIcons();
        }
      }

      carregarRanking();
    </script>
  </body>
</html>
